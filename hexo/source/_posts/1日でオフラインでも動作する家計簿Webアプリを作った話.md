---
title: 1日でオフラインでも動作する家計簿Webアプリを作った話
date: 2018-04-10 00:57:21
tags:
  - PWA
  - Nuxt
  - Bulma
  - localForage
category: Web Frontend
---

## ことの発端

先日、以前から知り合いで最近交流が活発になった後輩の**yamaken**君が**ワードウルフのiOSアプリを公開**しました。

{% twitter https://twitter.com/yamakentoc/status/979295582479990785 %}

非常にめでたい。ぜひぜひ、DLして遊んであげて下さい。

で、ノリと雰囲気でそのアプリのデザインレビューをやってたんですが、その後輩からふと、

**yamaken「あれ？先輩はアプリとか作らないんですか？」**

と言われてしまいまして。
スマートフォン用のネイティブアプリに関しては、デザインはやったことがあるけど実装はしたこと無いし、やってみるとしたらWebアプリかなあとか考えながら調べていたところ、**PWA** というえげつないしくみの存在を知ってしまいました。

<!-- more -->

## PWA(Progressive Web Application)

いきなりアルファベットばっかり出てきてもアレなので、普通のWebアプリ/Webサイトとの違いをざっくり並べてしまいます。

- **オフラインでも動作**する
- スマートフォンのブラウザアプリで**「ホームに追加」すると単体のアプリのように動作**できる
  - でも、実際はブラウザ機能を利用するので**容量は非常に軽い**
- プッシュ通知などの通知、電話の発信など、これまで**ネイティブアプリ"ならでは"だった機能が実装できる**

**すごくない？？？すごい！！！**ということで、勉強してみました。
ものすごく単純化して言うと、従来の**キャッシュ**に当たるローカルストレージを**発達したJavaScriptとブラウザAPIを駆使して厳密に管理**し、**Webサイト,アプリをまるごとキャッシュ** してしまい、ネイティブアプリぽい動作をブラウザAPIで担えるようにしてしまえ、と言うものです。

最近は、作りたいものがあったのでWebのバックエンドを裏でコツコツ作ってましたが、**短期間で簡単なアウトプットを出す** には良い題材だと思って、2018年4月9日、**思い至って作ってみました**。寝るまでに完成させることが自分に与える規約です。

---

## 作ったもの「TOKT」

[Two Option Keep Track](https://skawashima.github.io/keepTrack/)
（タイトル命名が酷く雑だ）

記事タイトルにもなっているとおり、**一度アクセスして表示してしまえば、機内モードにしても動作します**。もし使って頂ける方がいれば、**「ホームに追加」** もしてみて下さい。少なくともアンドロイドなら、iOSでも新しめのバージョンならネイティブアプリっぽく動く…はずです。

### アプリ紹介とこだわり
<img src='main.png' alt='メイン画面' style='border: solid 1px #ccc'>

家計簿アプリ「TOKT」は、**ユーザーが「必要な出費」か「不要な出費(=無駄遣い)」かを判断** しながら出費を入力すると、**それぞれの値段と割合が可視化** されるアプリです。また、ユーザーは**任意のタイミングでリセット** することも出来ます。

<img src='input.png' alt='入力画面' style='border: solid 1px #ccc'>
さらに、**入力画面ではテキストボックスに数式を入力できます**。複数のレシートを別々に入力するのが嫌いだったので、いっそ直接計算できるようにしてみました。

今までいろんな家計簿アプリを使ってきましたが、**システムがガッチガチ** 過ぎて**１日でも抜けてしまうとやめちゃいたくなる**現象が起きていました。そこで、これでもかと言うほどシンプルにし、柔軟な使い方ができるよう意識して機能を考えました。

…改めて見ると**UIデザインが酷い**ですね。特に入力画面は時間あれば修正します。

実は、TOKTを通して**ちょっとでも多くの人にPWAを知ってもらえたら満足**だったりします。まだあまり流行ってませんが、**いつ爆発してもおかしくない技術だ** と勝手に思ってますよ。

## 開発環境
[GitHub リポジトリ](https://github.com/sKawashima/keepTrack)

プルリクにまともに文字を書いてなかったりとか、焦りがハッキリ見えたりします。

使ったライブラリはこんな感じです。全部npmライブラリです。
- **Nuxt**: Vueのフレームワーク。滑らかなページ遷移はこいつのおかげ。
  - **Vue**: 変数の内容を表示内容に対応させるライブラリ。計算結果やグラフ表示に乱用。
  - **Vuex**: ページ遷移しながらデータを保持するためのVue用ライブラリ。
  - **@nuxtjs/pwa** NuxtでPWAを作るためのライブラリ。厳密なキャッシュ管理のほとんどを勝手にやってくれた。
- **Bulma**: CSSフレームワーク。使ってみようと思ったけど結局ボタンくらいしか使っていない。
- **localForage**: ローカルストレージに仮想的なDBを構築する。閉じたりリロードしたりしてもデータを保持できる。

### 嵌ったポイント
Vuexを用いたページ間のデータ保持とか、滑らかなページ遷移とか、データバインディングとかは経験していたので、それなりにサラサラ書けました。

が、**ローカルストレージに意図的にデータを格納し、それを呼び出すような処理** は使う技術の発見からガッツリ嵌ってました。具体的には、@nuxtjs/pwaで利用している**Cache API**を一部直書きして使おうとしてもよく分からず、頭を抱えながらCache APIよりも確実なデータ保持ができるという**IndexedDB**に結構な時間をかけて到達し、でも書き方がややこしくて頭を抱え、最終的にIndexedDBを簡単に書くための**localForage**に行き着いた、という感じになります。[この記事](http://neos21.hatenablog.com/entry/2017/11/01/080000)に出会っていなければ完成していたかどうか…

普段はWebページを作ることはあってもアプリケーションは滅多に作らないので、**VuexとlocalForageのデータのやり取り** や**JavaScriptの処理順の入れ替わり**などに苦しめられました。しかし、JavaScriptに慣れてきた影響で今抱えているWebサイト制作案件では**それなりに柔軟にいろんな挑戦が出来ている**ので、**技術を身につけるのも悪くない** なと思っております。

## 最後に
なんかこう、最近は**技術的なものづくりは頻繁にやってる**のに**デザイン的、アート的なことはスランプ気味**になっていてちょっとつらいです。久しぶりにガッツリ音楽に時間を割きたい…と思ったら**学校始まってる**し、どうしたものか。時間が足りない！！

といいつつ、**4/22にちょっとアート的に大暴れする予定がある** ので、無理にでも作曲に時間を割こうと思っています。今の自分の環境は本当に恵まれてるので、**出来る限りのことをやるとします**。ではまた！
